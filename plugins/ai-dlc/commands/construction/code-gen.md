---
description: ソフトウェアエンジニアとしてコードを生成
allowed-tools: Read, Write, Edit, Glob, Grep, Bash
argument-hint: [component-name]
---

# コード生成

あなたはソフトウェアエンジニアとして、ドメインモデルに基づいてコードを生成します。

## ワークフロー（TDDアプローチ）

本コマンドは**TDD（テスト駆動開発）** を基本とします。テストを先に書き、Red-Green-Refactorサイクルで実装を進めます。

> **注意**: テスト環境が未整備の場合など、TDDに沿わない進め方も許容しますが推奨しません。

### 1. 計画の作成

`aidlc-docs/<bolt>/plans/code_gen_plan.md` に計画を作成：

```markdown
# コード生成計画

## 対象コンポーネント
[コンポーネント名]

## アプローチ
- [x] TDD（推奨）
- [ ] 非TDD（テスト環境未整備などの理由がある場合のみ）

## ステップ（TDD）
- [ ] ステップ1: ドメインモデルの確認
- [ ] ステップ2: テスト作成（Red）
- [ ] ステップ3: 実装（Green）
- [ ] ステップ4: リファクタリング
- [ ] ステップ5: 次のコンポーネントへ（ステップ2-4を繰り返し）
```

### 2. ドメインモデル参照

`aidlc-docs/<bolt>/design-artifacts/domain/` のドメインモデルを参照。

### 3. TDDサイクル

各コンポーネント（エンティティ、値オブジェクト、リポジトリ、サービス等）に対して以下を繰り返す：

#### 3.1. Red: テストを先に作成

- ドメインモデルに基づき、期待する振る舞いをテストとして記述
- テストを実行し、**失敗することを確認**（実装がまだないため）

#### 3.2. Green: 最小限の実装

- テストを通過させる**最小限のコード**を実装
- テストを実行し、**成功することを確認**

#### 3.3. Refactor: リファクタリング

- コードの重複排除、命名改善、構造の整理
- テストが引き続き通過することを確認

### 4. 並列実行の自動判断

複数のユニット/コンポーネントを実装する場合、独立性を検証して並列実行を自動的に選択します。

#### 4.1. 独立性の検証

`aidlc-docs/<bolt>/design-artifacts/units/` の各ユニット定義を分析し、以下を確認：

- **依存関係の検証**: 各ユニットの「依存関係」セクションを確認し、相互依存がないユニット群を特定
- **編集対象ファイルの検証**: 同一ファイルを編集するユニットは順次実行が必要
- **共有インターフェースの検証**: 共通の内部インターフェースを定義・実装するユニットは順次実行が必要

#### 4.2. 実行戦略の決定

検証結果に基づき、自動的に実行戦略を決定：

| 条件 | 実行戦略 |
|------|----------|
| 相互依存なし・編集ファイル重複なし | **並列実行**: Task ツールで software-engineer エージェントに並列委譲 |
| 一方向の依存関係あり | **順次実行**: 依存元 → 依存先の順で実行 |
| 相互依存あり・ファイル重複あり | **順次実行**: 依存グラフの順序で実行 |

#### 4.3. 並列実行の実施

並列実行可能なユニット群に対して：

```
Task ツールで以下を並列実行：
- UNIT-A: software-engineer エージェントに委譲（TDDサイクル実行）
- UNIT-B: software-engineer エージェントに委譲（TDDサイクル実行）
- UNIT-C: software-engineer エージェントに委譲（TDDサイクル実行）
```

各エージェントは独立してTDDサイクルを実行し、完了を待機します。

### 5. 全体テスト実行

すべてのテストを実行し、結果を報告。失敗した場合は修正案を提示。

並列実行後は統合テストを実施し、ユニット間の連携が正常に動作することを確認します。

### 6. current.ymlの更新

完了後、current.ymlを更新：
- `step: architecture`
- `updated: <現在時刻>`
