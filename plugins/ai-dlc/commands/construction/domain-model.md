---
description: ソフトウェアエンジニアとしてドメイン（コンポーネント）モデルを設計
allowed-tools: Read, Write, Edit, Glob, Grep
argument-hint: [unit-name]
context: main
---

# ドメインモデル設計

あなたはソフトウェアエンジニアとして、DDDの原則を適用してドメインモデルを設計します。

## ワークフロー

### 0. ブラウンフィールド判定

1. **current.ymlの読み込み**
   - Readツールで `aidlc-docs/<bolt>/current.yml` を読み込み
   - `type` フィールドを確認

2. **分岐処理**
   - `type: brownfield` の場合 → 既存コード分析を実行（以下の手順）
   - `type: greenfield` の場合 → ステップ1へスキップ

**前提条件チェック**:
- `current.yml` が存在しない場合: エラー「セッションが見つかりません。先に `/ai-dlc:setup` を実行してください」
- `type` フィールドが存在しない場合: `greenfield` として扱う

#### 既存コード分析（ブラウンフィールドのみ）

1. **静的モデルの抽出**
   - 既存コードベースを探索（Glob, Grep, Read）
   - コンポーネント、クラス、モジュールの特定
   - 責任と関係の把握

2. **動的モデルの抽出**
   - 主要なユースケースのフローを追跡
   - コンポーネント間の相互作用を把握

3. **分析結果の記録**
   - `aidlc-docs/<bolt>/design-artifacts/existing-analysis.md` に保存：

```markdown
# 既存コードベース分析

## 静的モデル

### コンポーネント一覧
| コンポーネント | 責任 | 依存関係 |
|--------------|------|---------|
| [名前] | [責任] | [依存先] |

### 主要クラス/モジュール
- [クラス名]: [説明]

## 動的モデル

### 主要フロー
1. [ユースケース名]
   - [コンポーネントA] → [コンポーネントB] → ...

## 既存パターン
- [パターン名]: [使用箇所]

## 新機能との統合ポイント
- [統合が必要な箇所と方針]
```

> **注**: グリーンフィールドの場合はこのステップをスキップし、ステップ1から開始。

### 1. 計画の作成

`aidlc-docs/<bolt>/plans/domain_model_plan.md` に計画を作成：

```markdown
# ドメインモデル設計計画

## 対象ユニット
[ユニット名]

## ステップ
- [ ] ステップ1: ユーザーストーリーの分析
- [ ] ステップ2: エンティティと値オブジェクトの特定（要確認）
- [ ] ステップ3: 集約の定義
- [ ] ステップ4: ドメインイベントの特定
- [ ] ステップ5: リポジトリとファクトリの設計
```

### 2. ユニット参照

`aidlc-docs/<bolt>/design-artifacts/units/` のユニット定義を参照。

### 3. ドメインモデル作成

`aidlc-docs/<bolt>/design-artifacts/domain/` に保存：

```markdown
## ドメインモデル: [ユニット名]

### 集約
#### [集約名]
- **ルートエンティティ**: [名前]
- **エンティティ**: [リスト]
- **値オブジェクト**: [リスト]
- **不変条件**: [ビジネスルール]

### ドメインイベント
- [イベント名]: [発生条件と影響]

### リポジトリ
- [リポジトリ名]: [責任]
```

### 4. current.ymlの更新

完了後、current.ymlを更新：
- `step: code-gen`
- `updated: <現在時刻>`
